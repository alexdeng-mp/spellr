#!/usr/bin/env ruby
require_relative '../lib/spellr'
require 'optparse'

list = false
interactive = false

OptionParser.new do |opts|
  opts.on('--list', 'List files to be spellchecked') { list = true }
  opts.on('-i', '--interactive', "Runs the spell check interactively") { interactive = true }
  opts.on_tail('-v', '--version', "Returns the current version") { puts Spellr::VERSION; exit }
  opts.on_tail('-h', '--help', "Shows this message" ) { puts opts; exit }
end.parse!

files = Spellr::Files.new(globs: ARGV)

if list
  puts files.map(&:expand_path).join("\n")
  exit
end

unless Spellr::Dictionary['natural'].file.exist?
  STDERR.puts "Fetching the natural language dictionary"
  Spellr::DictionaryLoader.download
  unless Spellr::Dictionary['natural'].file.exist?
    STDERR.puts "There was an error fetching the natural language dictionary"
    exit 1
  end
end

checker = Spellr::Check.new(files: files, interactive: interactive)
checker.check

exit checker.exit_code
